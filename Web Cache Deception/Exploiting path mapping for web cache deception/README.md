## Lab Description :

![image](https://github.com/user-attachments/assets/14b70d39-9551-4baf-87ad-296ff65a673f)

## Solution :

Login to the site using the credentials provided - `wiener:peter`

Once logged in, we can see the API key of Wiener in the `/my-account` endpoint.
![image](https://github.com/user-attachments/assets/b0c3fe49-c195-47cb-aa21-2a2e7c29fcf3)

The above response is from the Origin server as it contains sensitive information.

### Analysing origin server's behaviour -

Entering random path at the end of the URI doesn't change the page's response.

![image](https://github.com/user-attachments/assets/8be95d27-317b-44b2-9d73-063cb5a5a50c)

As an attacker, we can abuse this origin server's behaviour to cache the reponse of this endpoint when another user clicks it.

### - Analysing Cache server's behaviour -

The cache server **caches the response of endpoints that end with static file extension** .

![image](https://github.com/user-attachments/assets/5c2b12fb-93dc-4d31-9b7b-a4b556a5fd21)

The `Cache: Miss` header indicates that the response came from Origin server .

Now the next time when we hit the same endpoint, we get `X-Cache: hit` endpoint which indicates the response is served from the cache.

![image](https://github.com/user-attachments/assets/321fc66c-7185-4f62-bfc8-492513c82086)


### Stealing Carlos's API key -

Now we want carlos to click on our malicious link, so we send the following payload to carlos using the exploit server.

```js
<script>document.location="https://0a58007d0382174983bf10b9000c00a3.web-security-academy.net/my-account/victim.js"</script>
```
Once carlos clicks on our link, the response will be stored in the cache server & then we can retreive the  API key of carlos by performing a unauthenticated GET request to that endpoint.

![image](https://github.com/user-attachments/assets/75b4d60d-1bdd-4641-bf50-83ad7261bb60)

Submit the API key of carlos & the lab is solved.

![image](https://github.com/user-attachments/assets/2ef84f46-dad5-459c-aeb3-423e9841b313)
